<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>管理员列表-WeAdmin Frame型后台管理系统-WeAdmin 1.0</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="stylesheet" href="../../static/css/font.css">
		<link rel="stylesheet" href="../../static/css/weadmin.css">
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
	      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
	      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
	    <![endif]-->
	</head>

	<body>
		<div class="weadmin-nav">
			<span class="layui-breadcrumb">
        <a href="">首页</a>
        <a href="">管理员管理</a>
        <a>
          <cite>管理员列表</cite></a>
      </span>
			<a class="layui-btn layui-btn-sm" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
				<i class="layui-icon" style="line-height:30px">ဂ</i></a>
		</div>
		<div class="weadmin-body">
			<div class="layui-row">
				<form class="layui-form layui-col-md12 we-search">

					<div class="weadmin-block">
						<button class="layui-btn layui-btn-danger">
							<i class="layui-icon layui-icon-search"></i>所在省份
						</button>
					</div>
					<div class="layui-input-block" id="btn-province">

					</div>

					<div class="weadmin-block">
						<button class="layui-btn layui-btn-danger">
							<i class="layui-icon layui-icon-search"></i>所在城市
						</button>
					</div>
					<div class="layui-input-block" id="btn-city">

					</div>
					<div class="weadmin-block">
						<button class="layui-btn layui-btn-danger">
							<i class="layui-icon layui-icon-search"></i>学校类型
						</button>
					</div>
					<div class="layui-input-block" id="btn-type">
					</div>
					<div class="weadmin-block">
						<button class="layui-btn layui-btn-danger">
							<i class="layui-icon layui-icon-search"></i>学校层次
						</button>
					</div>
					<div class="layui-input-block" id="btn-grade">

					</div>
					<div class="weadmin-block">
						<button class="layui-btn layui-btn-danger">
							<i class="layui-icon layui-icon-search"></i>办学层次
						</button>
					</div>
					<div class="layui-input-block" id="btn-level">

					</div>
					<div class="weadmin-block">
						<button class="layui-btn layui-btn-danger">
							<i class="layui-icon layui-icon-search"></i>办学类型
						</button>
					</div>
					<div class="layui-input-block" id="btn-nature">

					</div>

					<div class="layui-inline">
						<input type="text" name="exUniName" id="uniName" placeholder="请输入学校名称" autocomplete="off" class="layui-input">
					</div>
					<button class="layui-btn" lay-submit="" lay-filter="searchUniversity"><i class="layui-icon">&#xe615;</i></button>

				</form>
			</div>
			<div class="weadmin-block">
				<!--<button class="layui-btn layui-btn-danger" onclick="delAll()"><i class="layui-icon"></i>批量删除</button>-->
				<!--<button class="layui-btn" onclick="WeAdminShow('添加用户','./add.html')"><i class="layui-icon"></i>添加</button>-->
				<span class="fr" style="line-height:40px">共有数据：88 条</span>
			</div>
			<table class="layui-table" id="uniMsg" lay-filter="layui-major">
				<!--<thead>-->
					<!--<tr>-->
						<!--<th>-->
							<!--<div class="layui-unselect header layui-form-checkbox" lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>-->
						<!--</th>-->
						<!--<th>ID</th>-->
						<!--<th>登录名</th>-->
						<!--<th>手机</th>-->
						<!--<th>邮箱</th>-->
						<!--<th>角色</th>-->
						<!--<th>加入时间</th>-->
						<!--<th>状态</th>-->
						<!--<th>操作</th>-->
				<!--</thead>-->
				<!--<tbody>-->
					<!--<tr>-->
						<!--<td>-->
							<!--<div class="layui-unselect layui-form-checkbox" lay-skin="primary" data-id='2'><i class="layui-icon">&#xe605;</i></div>-->
						<!--</td>-->
						<!--<td>1</td>-->
						<!--<td>admin</td>-->
						<!--<td>18925139194</td>-->
						<!--<td>113664000@qq.com</td>-->
						<!--<td>超级管理员</td>-->
						<!--<td>2017-01-01 11:11:42</td>-->
						<!--<td class="td-status">-->
							<!--<span class="layui-btn layui-btn-normal layui-btn-xs">已启用</span></td>-->
						<!--<td class="td-manage">-->
							<!--<a onclick="member_stop(this,'10001')" href="javascript:;" title="启用">-->
								<!--<i class="layui-icon">&#xe601;</i>-->
							<!--</a>-->
							<!--<a title="编辑" onclick="WeAdminShow('编辑','./edit.html')" href="javascript:;">-->
								<!--<i class="layui-icon">&#xe642;</i>-->
							<!--</a>-->
							<!--<a title="删除" onclick="member_del(this,'要删除的id')" href="javascript:;">-->
								<!--<i class="layui-icon">&#xe640;</i>-->
							<!--</a>-->
						<!--</td>-->
					<!--</tr>-->
				<!--</tbody>-->

			</table>
			<div class="paging">

			</div>

		</div>
		<script src="../../lib/layui/layui.js" charset="utf-8"></script>
    	<script src="../../static/js/eleDel.js" type="text/javascript" charset="utf-8"></script>
		<!--操作按钮-->
		<script type="text/html" id="opBar">
			<a class="layui-btn layui-btn-xs" lay-event="edit">查看该学校专业信息</a>
		</script>
	</body>

<script type="text/javascript">
    layui.use(['laydate','jquery','admin','form','table','laypage'], function() {
        var laydate = layui.laydate,
            $ = layui.jquery,
            form = layui.form,
            table = layui.table,
            laypage = layui.laypage,
            admin = layui.admin;


			var limitcount = 10;
			var curnum = 1;
			var majorTypeList = null;
			var token = "";
			var cityLists = null,
				provinceLists = null,
				typeLists = null,
				gradeLists = null,
				levelLists = null,
				natureLists = null;


        	//页面加载时加载部分静态数据
			$(function () {
                token = localStorage.getItem("token");

                //提交post请求，加载数据
                $.post("http://localhost:8080/getStaticData?token="+token,function (res) {
                    provinceLists = res.listProvince;
                    gradeLists = res.listUniGrade;
                    levelLists = res.listUniLevel;
                    natureLists = res.listUniNature;
                    typeLists = res.listUniType;


                    var provinceHtml = "";
                    //遍历整个结果集，将省份字段嵌入html文本
                    res.listProvince.forEach(function (item,index) {
                        provinceHtml += "<button type='button' class='layui-btn layui-btn-primary layui-btn-sm' id=province"+index+"  value="+item.attrCode+"><i class='layui-icon'>&#xe6c6;</i>"+item.attrSpecName+"</button>";
                    });
                    $("#btn-province").append(provinceHtml);

                    //一开始默认选中第一个按钮  并加载第一个类别的专业信息
                    $("#province0").removeClass("layui-btn-primary");
                    $("#province0").addClass("layui-btn-warm");
                    var attrCode = $("#province0").val();
                    //这里需要调用查询省份下边的城市的接口
                    getCityMsgByType(attrCode);

                    //继续加载其他静态字段
                    //省份使用attrCode区分 城市以及其他value值使用attrValueId区分
                    var typeHtml = "";
                    res.listUniType.forEach(function (item,index) {
                        typeHtml += "<button type='button' class='layui-btn layui-btn-primary  layui-btn-sm' id=type"+index+"  value="+item.attrValueId+"><i class='layui-icon'>&#xe6c6;</i>"+item.attrValueName+"</button>";
                    });

                    var gradeHtml = "";
                    res.listUniGrade.forEach(function (item,index) {
                        gradeHtml += "<button type='button' class='layui-btn layui-btn-primary layui-btn-sm' id=grade"+index+"  value="+item.attrValueId+"><i class='layui-icon'>&#xe6c6;</i>"+item.attrValueName+"</button>";
                    });

                    var natureHtml = "";
                    res.listUniNature.forEach(function (item,index) {
                        natureHtml += "<button type='button' class='layui-btn layui-btn-primary layui-btn-sm' id=nature"+index+"  value="+item.attrValueId+"><i class='layui-icon'>&#xe6c6;</i>"+item.attrValueName+"</button>";
                    });

                    var levelHtml = "";
                    res.listUniLevel.forEach(function (item,index) {
                        levelHtml += "<button type='button' class='layui-btn layui-btn-primary layui-btn-sm' id=level"+index+"  value="+item.attrValueId+"><i class='layui-icon'>&#xe6c6;</i>"+item.attrValueName+"</button>";
                    });


                    $("#btn-type").append(typeHtml);
                    $("#btn-grade").append(gradeHtml);
                    $("#btn-nature").append(natureHtml);
                    $("#btn-level").append(levelHtml);
				});
            });

			//封装一个接口，根据用户点击的省份信息查询
			function  getCityMsgByType(attrCode) {

                $.post("http://localhost:8080/getCityByAttrCode?token="+token,{attrCode:attrCode},function (cityList) {
                    cityLists = cityList;
                    var cityHtml = "";
                    cityList.forEach(function (item,index) {
                        cityHtml += "<button type='button' class='layui-btn layui-btn-primary layui-btn-sm' id=city"+index+"  value="+item.attrValueId+"><i class='layui-icon'>&#xe6c6;</i>"+item.attrValueName+"</button>";
                    });
                    $("#btn-city").html(cityHtml);

                    //默认选中第一个城市
                    $("#city0").removeClass("layui-btn-primary");
                    $("#city0").addClass("layui-btn-warm");

                    //城市数据加载完成后应该默认加载该城市下的学校信息
					loadData(curnum,limitcount);
                });
			};

			//给所有省份按钮绑定事件，动态加载城市列表
			$(document).on('click','#btn-province .layui-btn',function (e) {
				var attrCode = $(this).val();
				var selector = "#btn-province button";
				var btnIdName = "#province";
				var selectedNor = "layui-btn-primary";
				var selected = "layui-btn-warm";
				dealBtn(selector,btnIdName,selectedNor,selected,attrCode);
                getCityMsgByType(attrCode);
			});

			//处理城市按钮的效果，这里不提交数据，
			$(document).on('click','#btn-city .layui-btn',function (e) {
				var majorCode = $(this).val();
				var selector = "#btn-city button";
				var btnIdName = "#city";
				var selectedNor = "layui-btn-primary";
				var selected = "layui-btn-warm";
				dealBtn(selector,btnIdName,selectedNor,selected,majorCode);
			});
			//处理学校类型按钮的效果，这里不提交数据，
			$(document).on('click','#btn-type .layui-btn',function (e) {
				var majorCode = $(this).val();
				var selector = "#btn-type button";
				var btnIdName = "#type";
				var selectedNor = "layui-btn-primary";
				var selected = "layui-btn-warm";
				dealBtn(selector,btnIdName,selectedNor,selected,majorCode);
			});
			//处理学校层次按钮的效果，这里不提交数据，
			$(document).on('click','#btn-grade .layui-btn',function (e) {
				var majorCode = $(this).val();
				var selector = "#btn-grade button";
				var btnIdName = "#grade";
				var selectedNor = "layui-btn-primary";
				var selected = "layui-btn-warm";
				dealBtn(selector,btnIdName,selectedNor,selected,majorCode);
			});
			//处理办学层次按钮的效果，这里不提交数据，
			$(document).on('click','#btn-level .layui-btn',function (e) {
				var majorCode = $(this).val();
				var selector = "#btn-level button";
				var btnIdName = "#level";
				var selectedNor = "layui-btn-primary";
				var selected = "layui-btn-warm";
				dealBtn(selector,btnIdName,selectedNor,selected,majorCode);
			});

			//处理办学类型按钮的效果，这里不提交数据，
			$(document).on('click','#btn-nature .layui-btn',function (e) {
				var majorCode = $(this).val();
				var selector = "#btn-nature button";
				var btnIdName = "#nature";
				var selectedNor = "layui-btn-primary";
				var selected = "layui-btn-warm";
				dealBtn(selector,btnIdName,selectedNor,selected,majorCode);
			});


			//条件查询学校信息,提交请求
			form.on('submit(searchUniversity)',function (data) {
				loadData(curnum,limitcount);
				return false;
			});

			//分页组件
			laypage.render({
				elem:'paging',
				count:81,
				limit:limitcount,
				limits:[10, 20, 30],
				groups:5,
				curr:1,
				jump:function (obj,first) {
					if(!first){
						loadData(obj.curr,obj.limit);
					}
				}
			});

			//封装一个收集所有条件参数的方法，返回值为Map
			function getQueryParams() {
			    // var provinceCode = "",
					// cityCode = "",
					// typeCode = "",
					// levelCode = "",
					// natureCode = "",
					// gradeCode = "";
			    var map = {};
			    //遍历所有按钮，将选中的按钮的值获取到
				provinceLists.forEach(function (item,index) {
				    // alert($("#province"+index).hasClass("layui-btn-warm"));
                    if($("#province"+index).hasClass("layui-btn-warm")){
                        map.provinceCode = $("#province"+index).val();
                    }
                });
				cityLists.forEach(function (item,index) {
				    if( $("#city"+index).hasClass("layui-btn-warm")){
                        map.cityCode = $("#city"+index).val();
					}
                });
                typeLists.forEach(function (item,index) {
                    if($("#type"+index).hasClass("layui-btn-warm")){
                        map.typeCode = $("#type"+index).val();
					}
                });
                levelLists.forEach(function (item,index) {
                    if($("#level"+index).hasClass("layui-btn-warm")){
                        map.levelCode = $("#level"+index).val();
					}
                });
                natureLists.forEach(function (item,index) {
                    if($("#nature"+index).hasClass("layui-btn-warm")){
                        map.natureCode = $("#nature"+index).val();
					}
                });
                gradeLists.forEach(function (item,index) {
                    if($("#grade"+index).hasClass("layui-btn-warm")){
                        map.gradeCode = $("#grade"+index).val();
					}
                });
				return map;

            };

			//监听toolbar工具栏操作
			table.on('tool(layui-major)',function (obj) {
				var data  =obj.data;		//获得该行数据
				var layEvent = obj.event;	//获得 lay-event 对应的值（
				var tr = obj.tr;  ////获得当前行 tr 的 DOM 对象（如果有的话）
				if(layEvent === 'edit'){
				    //alert(data.exUniId);
                    WeAdminEdit(data.exUniName+"专业列表",'./edit.html',data.exUniCode);
				}
            });


		//此处定义一个接口，手机用户选择的所有条件，查询到学校信息，直接调用查询学校的接口就可以
			function loadData(curr,limit) {
                var params = getQueryParams();
                console.log(params);
				table.render({
					elem: '#uniMsg',
					url: 'http://localhost:8080/searchCollageByExample',
					where:{
						exUniProvince:params.provinceCode,			//此处都要获得value值
						exUniCity:params.cityCode,
						exUniType:params.typeCode,
						exUniGrade:params.gradeCode,
						exUniNature:params.natureCode,
						exUniLevel:params.levelCode,
						exUniName:$("#uniName").val(),
						curr:curr,
						limit:limit
					},

					cols:[[
                        {
                            field:'exUniCode',
                            title:'学校代码',
                            sort:true,
                            width:200
                        },
						{
							field:'exUniName',
							title:'学校名称',
							sort:true,
							width:200
						},
						{
							field:'exUniCity',
							title:'城市',
							sort:true,
							width:200
						},
						{
							field:'exUniType',
							title:'学校类型',
							sort:true,
							width:200
						},
						{
							field:'exUniTel',
							title:'招生电话',
							sort:true,
							width:200
						},
						{
							field:'exUniWebsite',
							title:'学校网站',
							sort:true,
							width:200
						},
						{
						    title:'查看专业',
							fiexd:'right',
							width:150,
							align:'center',
							toolbar:'#opBar'
						}

					]],
					//,…… //其他参数

				});
			}



        /**
         * 处理页面按钮选择状态
         * @param selector  选择器
         * @param btnIdName  id前缀信息
         * @param selectedNor	未选中的class样式
         * @param selected		选中的class样式
         */
        function dealBtn(selector,btnIdName,selectedNor,selected,params) {
            Array.prototype.forEach.call(document.querySelectorAll(selector),function (item,index,arr) {
                //点击当前按钮之后，需要选择该按钮，并将其他按钮置为原状
                if(params && item.value != params){
                    $(btnIdName+index).addClass(selectedNor);
                    $(btnIdName+index).removeClass(selected);
                }else {
                    $(btnIdName+index).removeClass(selectedNor);
                    $(btnIdName+index).addClass(selected);
                }
                //alert(item.value);
            });
        }

    });

</script>

</html>